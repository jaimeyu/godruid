syntax = "proto3";

package gathergrpc;

import "google/api/annotations.proto";
import "google/protobuf/wrappers.proto";
import "google/protobuf/empty.proto";
import "gathergrpc/adminModels.proto";
import "gathergrpc/tenantModels.proto";
import "gathergrpc/metricModels.proto";
import "gathergrpc/commonModels.proto";


// Service responsible for provisioning Administration
// Users and their functionality, including creation of new 
// Tenants
service AdminProvisioningService {
    
    // Create a User with Administrative access. 
    rpc CreateAdminUser(AdminUser) returns (AdminUser) {
        option (google.api.http) = {
            post: "/api/v1/admin"
            body: "*"
        };
    }
    
    // Update a User with Administrative access. 
    rpc UpdateAdminUser(AdminUser) returns (AdminUser) {
        option (google.api.http) = {
            put: "/api/v1/admin"
            body: "*"
        };
    } 
    
    // Delete a User with Administrative access. 
    rpc DeleteAdminUser(google.protobuf.StringValue) returns (AdminUser) {
        option (google.api.http) = {
            delete: "/api/v1/admin/{value}"
        };
    }
    
    // Retrieve and Administrative User by id. 
    rpc GetAdminUser(google.protobuf.StringValue) returns (AdminUser) {
        option (google.api.http) = {
            get: "/api/v1/admin/{value}"
        };
    }
    
    // Retrieve all Administrative Users. 
    rpc GetAllAdminUsers(google.protobuf.Empty) returns (AdminUserList) {
        option (google.api.http) = {
            get: "/api/v1/admin-user-list"
        };
    }
    
    // Creates a Tenant and returns a TenantDescriptor which provides 
    // metadata for the newly created Tenant.   
    rpc CreateTenant(TenantDescriptor) returns (TenantDescriptor) {
        option (google.api.http) = {
            post: "/api/v1/tenants"
            body: "*"
        };
    }
    
    // Updates a TenantDescriptor, which provides metadata 
    // for the specified Tenant. 
    rpc UpdateTenantDescriptor(TenantDescriptor) returns (TenantDescriptor) {
        option (google.api.http) = {
            put: "/api/v1/tenants"
            body: "*"
        };
    } 
    
    // Deletes a Tenant and returns a TenantDescriptor which provides
    // metadata for the now deleted Tenant. 
    rpc DeleteTenant(google.protobuf.StringValue) returns (TenantDescriptor) {
        option (google.api.http) = {
            delete: "/api/v1/tenants/{value}"
        };
    }

    // Retrieves the metadata of a single Tenant by id.
    rpc GetTenantDescriptor(google.protobuf.StringValue) returns (TenantDescriptor) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{value}"
        };
    }

    // Retrieve all Users scoped to a single Tenant. 
    rpc GetAllTenantDescriptors(google.protobuf.Empty) returns (TenantDescriptorList) {
        option (google.api.http) = {
            get: "/api/v1/tenant-list"
        };
    }

    // Create an IngestionDictionary used for the entire deployment.
    rpc CreateIngestionDictionary(IngestionDictionary) returns (IngestionDictionary) {
        option (google.api.http) = {
            post: "/api/v1/ingestion-dictionaries"
            body: "*"
        };
    }
    
    // Update an IngestionDictionary used for the entire deployment.
    rpc UpdateIngestionDictionary(IngestionDictionary) returns (IngestionDictionary) {
        option (google.api.http) = {
            put: "/api/v1/ingestion-dictionaries"
            body: "*"
        };
    } 
    
    // Delete an IngestionDictionary used for the entire deployment.
    rpc DeleteIngestionDictionary(google.protobuf.Empty) returns (IngestionDictionary) {
        option (google.api.http) = {
            delete: "/api/v1/ingestion-dictionaries"
        };
    }
    
    // Retrieve an IngestionDictionary used for the entire deployment.
    rpc GetIngestionDictionary(google.protobuf.Empty) returns (IngestionDictionary) {
        option (google.api.http) = {
            get: "/api/v1/ingestion-dictionaries"
        };
    }

    // Retrieve a TenantID based on the comman name of the tenant.
    rpc GetTenantIDByAlias(google.protobuf.StringValue) returns (google.protobuf.StringValue) {
        option (google.api.http) = {
            get: "/api/v1/tenant-by-alias/{value}"
        };
    }

    rpc CreateValidTypes(ValidTypes) returns (ValidTypes) {
        option (google.api.http) = {
            post: "/api/v1/valid-types"
            body: "*"
        };
    }

    rpc UpdateValidTypes(ValidTypes) returns (ValidTypes) {
        option (google.api.http) = {
            put: "/api/v1/valid-types"
            body: "*"
        };
    }

    rpc GetValidTypes(google.protobuf.Empty) returns (ValidTypes) {
        option (google.api.http) = {
            put: "/api/v1/valid-types"
            body: "*"
        };
    }

    rpc GetSpecificValidTypes(ValidTypesRequest) returns (ValidTypesData) {
        option (google.api.http) = {
            post: "/api/v1/specific-valid-types"
            body: "*"
        };
    }
}


// Service responsible for provisioning Tenant scope data including
// Tenant Users, Tenant Domains, Tenant Injection Profiles.
service TenantProvisioningService {
    
    // Create a User scoped to a Single Tenant. 
    rpc CreateTenantUser(TenantUser) returns (TenantUser) {
        option (google.api.http) = {
            post: "/api/v1/tenants/{data.tenantId}/users"
            body: "*"
        };
    }
    
    // Update a User scoped to a single Tenant. 
    rpc UpdateTenantUser(TenantUser) returns (TenantUser) {
        option (google.api.http) = {
            put: "/api/v1/tenants/{data.tenantId}/users"
            body: "*"
        };
    } 
    
    // Delete a User scoped to a single Tenant. 
    rpc DeleteTenantUser(TenantUserIdRequest) returns (TenantUser) {
        option (google.api.http) = {
            delete: "/api/v1/tenants/{tenantId}/users/{userId}"
        };
    }
    
    // Retrieve a User scoped to a single Tenant. 
    rpc GetTenantUser(TenantUserIdRequest) returns (TenantUser) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{tenantId}/users/{userId}"
        };
    }
    
    // Retrieve all Users scoped to a single Tenant. 
    rpc GetAllTenantUsers(google.protobuf.StringValue) returns (TenantUserList) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{value}/user-list"
        };
    }

    // Create a Domain scoped to a Single Tenant. 
    rpc CreateTenantDomain(TenantDomain) returns (TenantDomain) {
        option (google.api.http) = {
            post: "/api/v1/tenants/{data.tenantId}/domains"
            body: "*"
        };
    }
    
    // Update a Domain scoped to a single Tenant. 
    rpc UpdateTenantDomain(TenantDomain) returns (TenantDomain) {
        option (google.api.http) = {
            put: "/api/v1/tenants/{data.tenantId}/domains"
            body: "*"
        };
    } 
    
    // Delete a Domain scoped to a single Tenant. 
    rpc DeleteTenantDomain(TenantDomainIdRequest) returns (TenantDomain) {
        option (google.api.http) = {
            delete: "/api/v1/tenants/{tenantId}/domains/{domainId}"
        };
    }
    
    // Retrieve a Domain scoped to a single Tenant. 
    rpc GetTenantDomain(TenantDomainIdRequest) returns (TenantDomain) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{tenantId}/domains/{domainId}"
        };
    }
    
    // Retrieve all Domains scoped to a single Tenant. 
    rpc GetAllTenantDomains(google.protobuf.StringValue) returns (TenantDomainList) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{value}/domain-list"
        };
    }

    // Create a Ingestion Profile scoped to a Single Tenant. 
    rpc CreateTenantIngestionProfile(TenantIngestionProfile) returns (TenantIngestionProfile) {
        option (google.api.http) = {
            post: "/api/v1/tenants/{data.tenantId}/ingestion-profiles"
            body: "*"
        };
    }
    
    // Updates an Ingestion Profile, which provides details on the data 
    // collected for the Tenant. 
    rpc UpdateTenantIngestionProfile(TenantIngestionProfile) returns (TenantIngestionProfile) {
        option (google.api.http) = {
            put: "/api/v1/tenants/{data.tenantId}/ingestion-profiles"
            body: "*"
        };
    } 

    // Retrieves an Ingestion Profile, which provides details on the data 
    // collected for the Tenant. 
    rpc GetTenantIngestionProfile(TenantIngestionProfileIdRequest) returns (TenantIngestionProfile) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{tenantId}/ingestion-profiles/{ingestionProfileId}"
        };
    }

    rpc GetActiveTenantIngestionProfile(google.protobuf.StringValue) returns (TenantIngestionProfile) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{value}/active-ingestion-profile"
        };
    }

    // Delete an Ingestion Profile scoped to a single Tenant. 
    rpc DeleteTenantIngestionProfile(TenantIngestionProfileIdRequest) returns (TenantIngestionProfile) {
        option (google.api.http) = {
            delete: "/api/v1/tenants/{tenantId}/ingestion-profiles/{ingestionProfileId}"
        };
    }


  // Create a Threshold Profile scoped to a Single Tenant. 
    rpc CreateTenantThresholdProfile(TenantThresholdProfile) returns (TenantThresholdProfile) {
        option (google.api.http) = {
            post: "/api/v1/tenants/{data.tenantId}/threshold-profiles"
            body: "*"
        };
    }
    
    // Updates an Threshold Profile, which provides details on the data 
    // collected for the Tenant. 
    rpc UpdateTenantThresholdProfile(TenantThresholdProfile) returns (TenantThresholdProfile) {
        option (google.api.http) = {
            put: "/api/v1/tenants/{data.tenantId}/threshold-profiles"
            body: "*"
        };
    } 

    // Retrieves an Threshold Profile, which provides details on the data 
    // collected for the Tenant. 
    rpc GetTenantThresholdProfile(TenantThresholdProfileIdRequest) returns (TenantThresholdProfile) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{tenantId}/threshold-profiles/{thresholdProfileId}"
        };
    }

    // Retrieve all Thresholds scoped to a single Tenant. 
    rpc GetAllTenantThresholdProfiles(google.protobuf.StringValue) returns (TenantThresholdProfileList) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{value}/threshold-profile-list"
        };
    }

    // Delete an Threshold Profile scoped to a single Tenant. 
    rpc DeleteTenantThresholdProfile(TenantThresholdProfileIdRequest) returns (TenantThresholdProfile) {
        option (google.api.http) = {
            delete: "/api/v1/tenants/{tenantId}/threshold-profiles/{thresholdProfileId}"
        };
    }

  
    // Create a MonitoredObject scoped to a Single Tenant. 
    rpc CreateMonitoredObject(MonitoredObject) returns (MonitoredObject) {
        option (google.api.http) = {
            post: "/api/v1/tenants/{data.tenantId}/monitored-objects"
            body: "*"
        };
    }
    
    // Update a MonitoredObject scoped to a single Tenant. 
    rpc UpdateMonitoredObject(MonitoredObject) returns (MonitoredObject) {
        option (google.api.http) = {
            put: "/api/v1/tenants/{data.tenantId}/monitored-objects"
            body: "*"
        };
    } 
    
    // Delete a MonitoredObject scoped to a single Tenant. 
    rpc DeleteMonitoredObject(MonitoredObjectIdRequest) returns (MonitoredObject) {
        option (google.api.http) = {
            delete: "/api/v1/tenants/{tenantId}/monitored-objects/{monitoredObjectId}"
        };
    }
    
    // Retrieve a MonitoredObject scoped to a single Tenant. 
    rpc GetMonitoredObject(MonitoredObjectIdRequest) returns (MonitoredObject) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{tenantId}/monitored-objects/{monitoredObjectId}"
        };
    }
    
    // Retrieve all MonitoredObject scoped to a single Tenant. 
    rpc GetAllMonitoredObjects(google.protobuf.StringValue) returns (MonitoredObjectList) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{value}/monitored-object-list"
        };
    }

    // Retrieve a mapping of Domain to Montiored Objects as either a count or a set of the 
    // ids of the monitored objects. 
    rpc GetMonitoredObjectToDomainMap(MonitoredObjectCountByDomainRequest) returns (MonitoredObjectCountByDomainResponse) {
        option (google.api.http) = {
            post: "/api/v1/tenants/{tenantId}/monitored-object-domain-map"
            body: "*"
        };
    }

    // Create TenantMeta scoped to a Single Tenant. 
    rpc CreateTenantMeta(TenantMetadata) returns (TenantMetadata) {
        option (google.api.http) = {
            post: "/api/v1/tenants/{data.tenantId}/meta"
            body: "*"
        };
    }
    
    // Update TenantMeta scoped to a single Tenant. 
    rpc UpdateTenantMeta(TenantMetadata) returns (TenantMetadata) {
        option (google.api.http) = {
            put: "/api/v1/tenants/{data.tenantId}/meta"
            body: "*"
        };
    } 
    
    // Delete TenantMeta scoped to a single Tenant. 
    rpc DeleteTenantMeta(google.protobuf.StringValue) returns (TenantMetadata) {
        option (google.api.http) = {
            delete: "/api/v1/tenants/{value}/meta"
        };
    }
    
    // Retrieve a User scoped to a single Tenant
    rpc GetTenantMeta(google.protobuf.StringValue) returns (TenantMetadata) {
        option (google.api.http) = {
            get: "/api/v1/tenants/{value}/meta"
        };
    }
}

// Service responsible for retrieving aggregate metrics from druid 
service MetricsService {
    
    // Retrieve threshold crossing for given metric.
    rpc GetThresholdCrossing(ThresholdCrossingRequest) returns (JSONAPIObject) {
        option (google.api.http) = {
            get: "/api/v1/threshold-crossing"
        };
    }

  rpc GetThresholdCrossingByMonitoredObject(ThresholdCrossingRequest) returns (JSONAPIObject) {
        option (google.api.http) = {
            get: "/api/v1/threshold-crossing-by-monitored-object"
        };
    }

    // Retrieve a histogram of measurements for given time range and metric
    rpc GetHistogram(HistogramRequest) returns (JSONAPIObject) {
        option (google.api.http) = {
            get: "/api/v1/histogram"
        };
    }
  
}

